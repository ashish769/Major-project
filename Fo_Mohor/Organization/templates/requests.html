{% extends 'reciever_base.html' %}
{% block title %}Requests{% endblock %}

{% block content %}
<h2 class="text-xl font-semibold mb-4">Waste Collection Requests</h2>
<div id="notificationBox" class="text-green-700 font-medium mb-3 hidden">Notification sent to users!</div>
<div class="grid gap-4">
  <div class="p-4 bg-gray-100 rounded shadow" data-type="plastic" data-lat="27.6720" data-lng="85.3240">
    <p><strong>Type:</strong> Plastic</p>
    <p><strong>Quantity:</strong> 10kg</p>
    <p><strong>Location:</strong> Lalitpur-10</p>
    <button class="mt-2 bg-green-500 text-white px-3 py-1 rounded" onclick="acceptRequest(this)">Accept</button>
  </div>
  <div class="p-4 bg-gray-100 rounded shadow" data-type="organic" data-lat="27.6675" data-lng="85.3230">
    <p><strong>Type:</strong> Organic</p>
    <p><strong>Quantity:</strong> 5kg</p>
    <p><strong>Location:</strong> Lalitpur-11</p>
    <button class="mt-2 bg-green-500 text-white px-3 py-1 rounded" onclick="acceptRequest(this)">Accept</button>
  </div>
</div>
<button class="mt-6 w-full bg-blue-600 text-white py-2 rounded" onclick="sendNotification()">Send Collection Time</button>
{% endblock %}

{% block extra_scripts %}
<script>
  const acceptedRequests = [];
  function acceptRequest(button) {
    const div = button.parentElement;
    const lat = parseFloat(div.getAttribute('data-lat'));
    const lng = parseFloat(div.getAttribute('data-lng'));
    acceptedRequests.push([lat, lng]);
    button.disabled = true;
    button.textContent = "Accepted";
  }

  function sendNotification() {
    const box = document.getElementById('notificationBox');
    if (acceptedRequests.length === 0) {
      alert("No requests accepted yet.");
    }
    box.classList.remove('hidden');
    setTimeout(() => box.classList.add('hidden'), 3000);
  }
</script>
{% endblock %}
